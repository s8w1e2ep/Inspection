var svg;var POINT_WIDTH=8;var POINT_WIDTH_OFFSET=POINT_WIDTH/2;var selectedParkingBlock;function OldRectangle(v,m,l,k,r,p){var o=this,e,i=[],n=false,c,a,z=true;o.rectData=[{x:l,y:k},{x:l+r,y:k+p}];var q=d3.behavior.drag().on("drag",h);var w=d3.behavior.drag().on("drag",g);var u=d3.behavior.drag().on("drag",f);var t=d3.behavior.drag().on("drag",d);var s=d3.behavior.drag().on("drag",b);svg.on("mousedown",function(){if(selectedParkingBlock!=null){selectedParkingBlock.selectAll(".pointC").style("visibility","hidden");hidePropertyPanel(PARKING_BLOCK)}});o.graphicElement=svg.select("#parkingBlock_g").append("g").attr("id",v).attr("class",m);o.rectangleElement=o.graphicElement.append("rect").attr("class","parkingBlock").attr("x",l).attr("y",k).attr("width",r).attr("height",p).call(q).on("mousedown",function(){if(selectedParkingBlock!=null){selectedParkingBlock.selectAll(".pointC").style("visibility","hidden")}o.graphicElement.selectAll(".pointC").style("visibility","");selectedParkingBlock=o.graphicElement;showPropertyPanel(PARKING_BLOCK);j();d3.event.stopPropagation()}).on("mouseup",function(){updateParkingBlockRangeToServer(o.graphicElement,e.attr("x"),e.attr("y"),e.attr("width"),e.attr("height"))}).on("mouseover",function(){d3.select(this).style("cursor","move")}).on("mouseout",function(){d3.select(this).style("cursor","")});o.pointElement1=o.graphicElement.append("rect").attr("class","pointC").call(w);o.pointElement2=o.graphicElement.append("rect").attr("class","pointC").call(u);o.pointElement3=o.graphicElement.append("rect").attr("class","pointC").call(t);o.pointElement4=o.graphicElement.append("rect").attr("class","pointC").call(s);o.graphicElement.selectAll(".pointC").on("mousedown",function(){d3.event.stopPropagation()}).on("mouseup",function(){updateParkingBlockRangeToServer(o.graphicElement,e.attr("x"),e.attr("y"),e.attr("width"),e.attr("height"))});function j(){e=d3.select(o.rectangleElement[0][0]);e.attr({x:o.rectData[1].x-o.rectData[0].x>0?o.rectData[0].x:o.rectData[1].x,y:o.rectData[1].y-o.rectData[0].y>0?o.rectData[0].y:o.rectData[1].y,width:Math.abs(o.rectData[1].x-o.rectData[0].x),height:Math.abs(o.rectData[1].y-o.rectData[0].y)});var A=d3.select(o.pointElement1[0][0]).data(o.rectData);A.attr("width",POINT_WIDTH).attr("height",POINT_WIDTH).attr("x",o.rectData[0].x-POINT_WIDTH_OFFSET).attr("y",o.rectData[0].y-POINT_WIDTH_OFFSET);var y=d3.select(o.pointElement2[0][0]).data(o.rectData);y.attr("width",POINT_WIDTH).attr("height",POINT_WIDTH).attr("x",o.rectData[1].x-POINT_WIDTH_OFFSET).attr("y",o.rectData[1].y-POINT_WIDTH_OFFSET);var x=d3.select(o.pointElement3[0][0]).data(o.rectData);x.attr("width",POINT_WIDTH).attr("height",POINT_WIDTH).attr("x",o.rectData[1].x-POINT_WIDTH_OFFSET).attr("y",o.rectData[0].y-POINT_WIDTH_OFFSET);var x=d3.select(o.pointElement4[0][0]).data(o.rectData);x.attr("width",POINT_WIDTH).attr("height",POINT_WIDTH).attr("x",o.rectData[0].x-POINT_WIDTH_OFFSET).attr("y",o.rectData[1].y-POINT_WIDTH_OFFSET)}function h(){var y=d3.event;for(var x=0;x<o.rectData.length;x++){d3.select(o.rectangleElement[0][0]).attr("x",o.rectData[x].x+=y.dx).attr("y",o.rectData[x].y+=y.dy)}e.style("cursor","move");j()}function g(){var x=d3.event;d3.select(o.pointElement1[0][0]).attr("x",function(y){return y.x+=x.dx}).attr("y",function(y){return y.y+=x.dy});j()}function f(){var x=d3.event;d3.select(o.pointElement2[0][0]).attr("x",o.rectData[1].x+=x.dx).attr("y",o.rectData[1].y+=x.dy);j()}function d(){var x=d3.event;d3.select(o.pointElement3[0][0]).attr("x",o.rectData[1].x+=x.dx).attr("y",o.rectData[0].y+=x.dy);j()}function b(){var x=d3.event;d3.select(o.pointElement4[0][0]).attr("x",o.rectData[0].x+=x.dx).attr("y",o.rectData[1].y+=x.dy);j()}}function Rectangle(){var l=this,d,i=[],k=false,c,a,r=false;svg.on("mousedown",function(){c=d3.mouse(this);if(!k&&!r){l.rectData=[{x:c[0],y:c[1]},{x:c[0],y:c[1]}];l.graphicElement=svg.select("#parkingBlock_g").append("g");l.rectangleElement=l.graphicElement.append("rect").attr("class","parkingBlock").call(m);l.rectangleElement.on("mousedown",function(){if(selectedParkingBlock!=null){selectedParkingBlock.selectAll(".pointC").style("visibility","hidden")}l.graphicElement.selectAll(".pointC").style("visibility","");selectedParkingBlock=l.graphicElement;j();d3.event.stopPropagation()}).on("mouseup",function(){updateParkingBlockRangeToServer(l.graphicElement,d.attr("x"),d.attr("y"),d.attr("width"),d.attr("height"))});l.pointElement1=l.graphicElement.append("rect").attr("class","pointC").call(q);l.pointElement2=l.graphicElement.append("rect").attr("class","pointC").call(p);l.pointElement3=l.graphicElement.append("rect").attr("class","pointC").call(o);l.pointElement4=l.graphicElement.append("rect").attr("class","pointC").call(n);l.graphicElement.selectAll(".pointC").on("mousedown",function(){d3.event.stopPropagation()}).on("mouseup",function(){updateParkingBlockRangeToServer(l.graphicElement,d.attr("x"),d.attr("y"),d.attr("width"),d.attr("height"))});j();r=false}else{if(!r){addParkingBlockToServer(l.graphicElement,l.rectangleElement.attr("x"),l.rectangleElement.attr("y"),l.rectangleElement.attr("width"),l.rectangleElement.attr("height"));selectedParkingBlock=l.graphicElement}else{if(selectedParkingBlock!=null){selectedParkingBlock.selectAll(".pointC").style("visibility","hidden")}}r=true}k=!k}).on("mousemove",function(){a=d3.mouse(this);if(k&&!r){l.rectData[1]={x:a[0],y:a[1]};j()}});function j(){d=d3.select(l.rectangleElement[0][0]);d.attr({x:l.rectData[1].x-l.rectData[0].x>0?l.rectData[0].x:l.rectData[1].x,y:l.rectData[1].y-l.rectData[0].y>0?l.rectData[0].y:l.rectData[1].y,width:Math.abs(l.rectData[1].x-l.rectData[0].x),height:Math.abs(l.rectData[1].y-l.rectData[0].y)});var u=d3.select(l.pointElement1[0][0]).data(l.rectData);u.attr("width",POINT_WIDTH).attr("height",POINT_WIDTH).attr("x",l.rectData[0].x-POINT_WIDTH_OFFSET).attr("y",l.rectData[0].y-POINT_WIDTH_OFFSET);var t=d3.select(l.pointElement2[0][0]).data(l.rectData);t.attr("width",POINT_WIDTH).attr("height",POINT_WIDTH).attr("x",l.rectData[1].x-POINT_WIDTH_OFFSET).attr("y",l.rectData[1].y-POINT_WIDTH_OFFSET);var s=d3.select(l.pointElement3[0][0]).data(l.rectData);s.attr("width",POINT_WIDTH).attr("height",POINT_WIDTH).attr("x",l.rectData[1].x-POINT_WIDTH_OFFSET).attr("y",l.rectData[0].y-POINT_WIDTH_OFFSET);var s=d3.select(l.pointElement4[0][0]).data(l.rectData);s.attr("width",POINT_WIDTH).attr("height",POINT_WIDTH).attr("x",l.rectData[0].x-POINT_WIDTH_OFFSET).attr("y",l.rectData[1].y-POINT_WIDTH_OFFSET)}var m=d3.behavior.drag().on("drag",h);function h(){var t=d3.event;for(var s=0;s<l.rectData.length;s++){d3.select(l.rectangleElement[0][0]).attr("x",l.rectData[s].x+=t.dx).attr("y",l.rectData[s].y+=t.dy)}d.style("cursor","move");j()}var q=d3.behavior.drag().on("drag",g);var p=d3.behavior.drag().on("drag",f);var o=d3.behavior.drag().on("drag",e);var n=d3.behavior.drag().on("drag",b);function g(){var s=d3.event;d3.select(l.pointElement1[0][0]).attr("x",function(t){return t.x+=s.dx}).attr("y",function(t){return t.y+=s.dy});j()}function f(){var s=d3.event;d3.select(l.pointElement2[0][0]).attr("x",l.rectData[1].x+=s.dx).attr("y",l.rectData[1].y+=s.dy);j()}function e(){var s=d3.event;d3.select(l.pointElement3[0][0]).attr("x",l.rectData[1].x+=s.dx).attr("y",l.rectData[0].y+=s.dy);j()}function b(){var s=d3.event;d3.select(l.pointElement4[0][0]).attr("x",l.rectData[0].x+=s.dx).attr("y",l.rectData[1].y+=s.dy);j()}};